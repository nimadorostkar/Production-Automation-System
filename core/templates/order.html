{% extends 'layouts/base.html' %}
{% load static %}
{% block title %} manufactures {% endblock %}

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}{% endblock stylesheets %}

{% block content %}

<div class="row">
  <div class="col-md-12">
    <div class="card" align="right" dir="rtl">
      <div class="card-header">
        <h4 class="card-title"> سفارشات برحسب محصولات </h4>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table tablesorter " id="">
            <thead class=" text-primary">
              <tr>
                <th>
                  نام
                </th>
                <th>
                  تیراژ
                </th>
                <th>
                  زمان شروع
                </th>
                <th>
                  توضیحات
                </th>
                <th class="text-center">
                 کد
                </th>
              </tr>
            </thead>
            <tbody>
            {% for Order in orders %}
              <tr>
                <td> <a href="{{ Order.get_absolute_url }}"> {{ Order.product }} </a> </td>
                <td> {{ Order.circulation }} </td>
                <td> {{ Order.start_time }} </td>
                <td> {{ Order.description|slice:":80" }}... </td>
                <td class="text-center"> {{ Order.code }} </td>
              </tr>
            {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>







<div class="row">
  <div class="col-md-12">
    <div class="card" align="right" dir="rtl">
      <div class="card-header">
        <h4 class="card-title"> فرایند های درگیر </h4>
      </div>
      <div class="card-body">

        <div align="center" id="process_orders"> </div>






          <script>
            var array = [
              {% for Order in orders %}
               {% for Tree in tree %}
                {% for relatedProduct in Tree.relatedProduct.all %}
                  {% if relatedProduct == Order.product %}
                    { "name":"{{Tree.name}}", "tot":{% widthratio Tree.quantity 1 Order.circulation %} },
                  {% endif %}
                {% endfor %}
               {% endfor %}
              {% endfor %}
            ];

            var orders = array.reduce(function (agg, obj) {
              var objForName = agg.filter(function (nameObj) { return nameObj.name === obj.name})[0]

              if (objForName) {
                objForName.total += obj.tot;
              } else {
                agg.push({
                  name: obj.name,
                  total: obj.tot
                })
              }
              return agg;
            }, [])

            console.log(orders)

            var process = document.getElementById("process_orders");
            for(var i=0; i < orders.length; i++){
              process.innerHTML += "<h6>"+orders[i].name+"  "+orders[i].total+"</h6><br>";
            }






          </script>




      </div>
    </div>
  </div>
</div>








{% endblock content %}

<!-- Specific Page JS goes HERE  -->
{% block javascripts %}{% endblock javascripts %}
